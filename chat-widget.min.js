!function(){"use strict";var e=800,t="mbhvac_chat_state",n="mbhvac_chat_analytics",a=null,i=null,o=null,s=null,l=null,c=null,r=!1;function u(){var e=new Date,t=e.getHours(),n=e.getDay(),a=e.getMonth(),i=!1,o="";t>=21||t<6?(o="late",i=!0):t>=18?(o="evening",i=!0):t<8&&(o="early morning",i=!0),0!==n&&6!==n||(i=!0);var s="general";return a>=5&&a<=8?s="summer":(a>=10||a<=2)&&(s="winter"),{hour:t,day:n,timeLabel:o,isOffHours:i,season:s}}function d(e){try{var t=JSON.parse(localStorage.getItem(n)||"{}");t[e]=(t[e]||0)+1,t._total=(t._total||0)+1,localStorage.setItem(n,JSON.stringify(t))}catch(e){}}function m(e,n){try{var a=JSON.parse(localStorage.getItem(t)||"{}");a[e]=n,localStorage.setItem(t,JSON.stringify(a))}catch(e){}}function h(e){try{return JSON.parse(localStorage.getItem(t)||"{}")[e]}catch(e){return}}function v(e){m("lastVisitPath",e),m("lastVisitTimestamp",Date.now())}function f(e){var t=document.createElement("div");t.className="chat-msg bot",t.innerHTML='<div class="chat-msg-bubble">'+N(e)+"</div>",o.appendChild(t),M()}function g(e){var t=document.createElement("div");t.className="chat-msg user",t.innerHTML='<div class="chat-msg-bubble">'+N(e)+"</div>",o.appendChild(t),M()}function p(){var e,t=(e=u()).isOffHours?"late"===e.timeLabel?"It's late, but our emergency technicians are standing by right now.":"evening"===e.timeLabel?"Even though it's evening, our team is still available for emergencies.":"early morning"===e.timeLabel?"Early morning? No worries — our team is available 24/7.":0===e.day?"Yes, we're available on Sundays! Our team is here when you need us.":6===e.day?"Weekend? We're still here. Our technicians are available today.":"":"";if(t){var n=document.createElement("div");n.className="chat-time-banner",n.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>'+N(t),o.appendChild(n),M()}}function y(e,t){var n=document.createElement("div");n.className="chat-safety-tip"+(t?" info":"");var a=t?'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>':'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>';n.innerHTML=a+"<span>"+N(e)+"</span>",o.appendChild(n),M()}function b(){var e=document.createElement("div");e.className="chat-typing",e.id="chatTypingIndicator",e.innerHTML='<span class="chat-typing-dot"></span><span class="chat-typing-dot"></span><span class="chat-typing-dot"></span>',o.appendChild(e),M()}function w(){var e=document.getElementById("chatTypingIndicator");e&&e.remove()}function k(){var e=document.createElement("a");e.className="chat-phone-cta",e.href="tel:7814082506",e.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>Call (781) 408-2506 — Available 24/7',o.appendChild(e),M()}function x(e,t){var n=document.createElement("a");n.className="chat-link-cta",n.href=t,n.innerHTML=N(e)+'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>',o.appendChild(n),M()}function T(t){var n=document.createElement("div");n.className="chat-options",t.forEach(function(t){var a=document.createElement("button");a.className="chat-option-btn",a.textContent=t.label,a.addEventListener("click",function(){!function(t){if(o.querySelectorAll(".chat-options").forEach(function(e){e.querySelectorAll(".chat-option-btn").forEach(function(e){e.disabled=!0,e.style.opacity="0.5",e.style.cursor="default",e.style.pointerEvents="none"})}),g(t.label),d(t.next),"_urgent_yes"===t.next)return b(),void setTimeout(function(){w(),f("We'll get someone out to you. Give us a call and we can usually have a technician there within the hour."),setTimeout(function(){k()},300),setTimeout(function(){T([{label:"What will the visit cost?",next:"faq_emergency_pricing"},{label:"What should I expect?",next:"what_to_expect"},{label:"Start over",next:"welcome",restart:!0}])},500)},e);if("_urgent_no"===t.next)return b(),void setTimeout(function(){w(),f("No problem. When you're ready, give us a call or reach out online. We're here 24/7."),setTimeout(function(){k()},300),setTimeout(function(){x("Contact Us Online","contact.html")},500),setTimeout(function(){T([{label:"Do you have any specials?",next:"offers_plug"},{label:"Start over",next:"welcome",restart:!0}])},700)},e);t.restart?setTimeout(function(){C()},600):(-1!==["emergency","maintenance","quote","general"].indexOf(t.next)&&v(t.next),E(t.next))}(t)}),n.appendChild(a)}),o.appendChild(n),M()}function _(t){var n=a.symptom_data,i=document.createElement("div");i.className="chat-multi-select";var s={};t.forEach(function(e){var t=n[e];if(t){var a=document.createElement("button");a.className="chat-multi-option",a.innerHTML='<span class="chat-multi-check"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></span>'+N(t.label),a.addEventListener("click",function(){s[e]?(delete s[e],a.classList.remove("selected")):(s[e]=!0,a.classList.add("selected"));var t=Object.keys(s).length;l.className="chat-multi-continue"+(t>0?" enabled":""),l.textContent=t>0?"Continue with "+t+" issue"+(t>1?"s":"")+" selected":"Select at least one issue"}),i.appendChild(a)}}),o.appendChild(i);var l=document.createElement("button");l.className="chat-multi-continue",l.textContent="Select at least one issue",l.addEventListener("click",function(){var t=Object.keys(s);0!==t.length&&(i.querySelectorAll(".chat-multi-option").forEach(function(e){e.style.pointerEvents="none",e.style.opacity="0.6"}),l.style.pointerEvents="none",l.style.opacity="0.5",g(t.map(function(e){return n[e].label}).join(", ")),t.forEach(function(e){d("symptom_"+e)}),v("emergency"),function(t){var n=a.safety_tips,i=(u(),t.length);b(),setTimeout(function(){w(),f("Thanks for letting us know. Before calling, a couple quick things worth checking: make sure your thermostat is set correctly, check your air filter (a dirty filter causes more issues than you'd think), and take a look at your breaker panel for anything tripped. Beyond that, this is something a technician should look at in person.");var a=400;-1!==t.indexOf("bad_smell")&&(setTimeout(function(){y(n.gas_smell)},a),a+=300),-1!==t.indexOf("leaking")&&(setTimeout(function(){y(n.water_damage)},a),a+=300),setTimeout(function(){!function(t,n){u();var a=n>=3||-1!==t.indexOf("bad_smell")||-1!==t.indexOf("wont_start")&&(-1!==t.indexOf("strange_noise")||-1!==t.indexOf("leaking"));a?(b(),setTimeout(function(){w(),f("Based on what you're describing, I'd recommend having a technician take a look as soon as possible. We're available 24/7."),setTimeout(function(){k()},300),setTimeout(function(){T([{label:"What should I expect during the visit?",next:"what_to_expect"},{label:"How old is my system — does it matter?",next:"system_age"},{label:"Start over",next:"welcome",restart:!0}])},500)},e)):(b(),setTimeout(function(){w(),f("Would you like us to send someone out, or are you okay for now?"),T([{label:"I'd like to schedule a visit",next:"_urgent_yes"},{label:"I'm okay for now",next:"_urgent_no"},{label:"Already tried the basics — still not working",next:"_urgent_yes"}])},e))}(t,i)},a+200)},e)}(t))}),o.appendChild(l),M()}function E(t){var n=a[t];n||(n=a.fallback);var i=n.messages||[],o=0;b(),o+=i.length>1?1400:e,i.forEach(function(t,a){setTimeout(function(){if(w(),f(t),a===i.length-1){var e=300;if("multi_select"===n.type&&n.symptom_keys)return void setTimeout(function(){_(n.symptom_keys)},e);n.phone_cta&&(setTimeout(function(){k()},e),e+=200),n.link_cta&&(setTimeout(function(){x(n.link_cta.label,n.link_cta.url)},e),e+=200),n.options&&n.options.length>0&&setTimeout(function(){T(n.options)},e)}else b()},o),o+=e})}function L(e){if(e.messages_variants&&e.messages_variants.length>0){var t=Math.floor(Math.random()*e.messages_variants.length);return e.messages_variants[t]}return e.messages||[]}function C(){o.innerHTML="",p();var t=function(){var e=h("lastVisitPath"),t=h("lastVisitTimestamp");if(!e||!t)return null;var n=(Date.now()-t)/864e5;return n>7?null:{path:e,daysSince:n}}(),n=u();if(t&&"emergency"===t.path&&a.return_welcome_emergency)E("return_welcome_emergency");else{var i="welcome";"winter"===n.season&&a.welcome_winter?i="welcome_winter":"summer"===n.season&&a.welcome_summer&&(i="welcome_summer");var s=a[i],l=a.welcome.options,c=L(s);0===c.length&&(c=L(a.welcome));var r=0;b(),r+=e,c.forEach(function(t,n){setTimeout(function(){w(),f(t),n===c.length-1?setTimeout(function(){T(l)},300):b()},r),r+=e})}}function O(){r=!0,i.classList.add("open"),s.classList.add("active"),l.classList.remove("visible"),c.classList.remove("visible"),m("minimized",!1),m("hasOpened",!0),0===o.children.length&&C(),M()}function S(){r=!1,i.classList.remove("open"),s.classList.remove("active"),m("minimized",!0)}function M(){setTimeout(function(){o.scrollTop=o.scrollHeight},50)}function N(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}function B(){var e;(e=document.createElement("div")).id="chatWidgetRoot",e.innerHTML='<button class="chat-toggle" id="chatToggle" aria-label="Open chat"><span class="chat-unread" id="chatUnread">1</span><span class="chat-tooltip" id="chatTooltip">Need help? Chat with us</span><svg class="chat-icon-open" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><svg class="chat-icon-close" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button><div class="chat-window" id="chatWindow"><div class="chat-header"><div class="chat-header-avatar"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg></div><div class="chat-header-info"><div class="chat-header-title">HVAC HELP CENTER</div><div class="chat-header-status"><span class="chat-header-status-dot"></span>We\'re online</div></div><div class="chat-header-actions"><button id="chatMinimize" aria-label="Minimize chat"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="6" y1="18" x2="18" y2="6"/><line x1="6" y1="6" x2="18" y2="18"/></svg><span class="chat-minimize-label">Close</span></button></div></div><div class="chat-messages" id="chatMessages"></div><div class="chat-footer"><button class="chat-footer-start-over" id="chatStartOver"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>Start over</button></div></div>',document.body.appendChild(e),document.body.classList.add("chat-widget-loaded"),s=document.getElementById("chatToggle"),i=document.getElementById("chatWindow"),o=document.getElementById("chatMessages"),l=document.getElementById("chatUnread"),c=document.getElementById("chatTooltip"),s.addEventListener("click",function(){r?S():O()}),document.getElementById("chatMinimize").addEventListener("click",S),document.getElementById("chatStartOver").addEventListener("click",function(){C()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&r&&S()});var t=h("minimized"),n=h("hasOpened");t?setTimeout(function(){l.classList.add("visible")},2e3):n||(setTimeout(function(){c.classList.add("visible")},3e3),setTimeout(function(){c.classList.remove("visible"),r||O()},1e4))}!function(e){var t,n=document.currentScript||(t=document.getElementsByTagName("script"))[t.length-1],i="";n&&n.src&&(i=n.src.substring(0,n.src.lastIndexOf("/")+1));var o=new XMLHttpRequest;o.open("GET",i+"chat-data.json",!0),o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status)try{a=JSON.parse(o.responseText),e()}catch(e){console.warn("Chat widget: Failed to parse chat data")}else console.warn("Chat widget: Could not load chat-data.json")},o.send()}(function(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",B):B()})}();